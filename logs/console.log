(base) victorkhudyakov@MacBook-Pro-Victor 3DDFA2 % python main.py test
INFO: Директория создана/проверена: /Users/victorkhudyakov/nn/3DDFA2/data
INFO: Директория создана/проверена: /Users/victorkhudyakov/nn/3DDFA2/models
INFO: Директория создана/проверена: /Users/victorkhudyakov/nn/3DDFA2/results
INFO: Директория создана/проверена: /Users/victorkhudyakov/nn/3DDFA2/configs
INFO: Директория создана/проверена: /Users/victorkhudyakov/nn/3DDFA2/cache
INFO: Директория создана/проверена: /Users/victorkhudyakov/nn/3DDFA2/logs
INFO: Директория создана/проверена: /Users/victorkhudyakov/nn/3DDFA2/templates
INFO: Директория создана/проверена: /Users/victorkhudyakov/nn/3DDFA2/weights
INFO: Веса аутентичности валидны, сумма: 1.0
INFO: Breakthrough years для технологий масок: [2008, 2014, 2019, 2022]
INFO: Инициализация CoreConfig
INFO: Начало валидации конфигурации
INFO: Получение метрик идентичности
INFO: Загружено 15 метрик идентичности
INFO: Получение параметров хронологического анализа
INFO: Валидация конфигурации успешно завершена
INFO: Сохранение снимка конфигурации
INFO: Снимок конфигурации сохранен: /Users/victorkhudyakov/nn/3DDFA2/configs/config_snapshot_2025-06-17T19-09-26.396230.json
INFO: Снимок конфигурации сохранен: /Users/victorkhudyakov/nn/3DDFA2/configs/config_snapshot_2025-06-17T19-09-26.396230.json
INFO: CoreConfig успешно инициализирован
DEBUG: matplotlib data path: /Users/victorkhudyakov/.pyenv/versions/3.8.10/lib/python3.8/site-packages/matplotlib/mpl-data
DEBUG: CONFIGDIR=/Users/victorkhudyakov/.matplotlib
DEBUG: interactive is False
DEBUG: platform is darwin
DEBUG: CACHEDIR=/Users/victorkhudyakov/.matplotlib
DEBUG: Using fontManager instance from /Users/victorkhudyakov/.matplotlib/fontlist-v330.json
INFO: 3DDFA компоненты успешно импортированы
INFO: Начало инициализации 3DDFA компонентов
INFO: FaceBoxes инициализирован
INFO: TDDFA (PyTorch) инициализирован
INFO: 3DDFA компоненты успешно инициализированы
INFO: Инициализация Face3DAnalyzer
WARNING: TDDFA модель не инициализирована или не содержит BFM для загрузки референсной модели.
INFO: Получение конфигураций видов
INFO: Получение метрик идентичности
INFO: Загружено 15 метрик идентичности
INFO: Face3DAnalyzer инициализирован
DEBUG: [extract_68_landmarks] Начало. Размер изображения: (800, 800, 3), Тип: uint8
DEBUG: [extract_68_landmarks] FaceBoxes вернул: 1 боксов. Тип: <class 'numpy.ndarray'>
DEBUG: [extract_68_landmarks] Содержимое boxes (первые 5): [[192.23175   153.15627   595.802     729.1539      0.9999654]]
DEBUG: [extract_68_landmarks] Выбранный бокс: [192, 153, 595, 729]
DEBUG: [extract_68_landmarks] TDDFA param_lst[0] shape: (62,)
ERROR: [extract_68_landmarks] Ошибка извлечения ландмарок: 'list' object has no attribute 'shape'
/Users/victorkhudyakov/nn/3DDFA2/face_3d_analyzer.py:1285: RuntimeWarning: Mean of empty slice.
  print(lmk.shape, conf.mean())   # => (68, 3) 0.93
/Users/victorkhudyakov/.pyenv/versions/3.8.10/lib/python3.8/site-packages/numpy/core/_methods.py:192: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
(0,) nan
INFO: InsightFace успешно импортирован
INFO: Конфигурация успешно импортирована
INFO: Инициализация EmbeddingAnalyzer
INFO: Начало инициализации InsightFace Buffalo-L
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /Users/victorkhudyakov/.insightface/models/buffalo_l/1k3d68.onnx landmark_3d_68 ['None', 3, 192, 192] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /Users/victorkhudyakov/.insightface/models/buffalo_l/2d106det.onnx landmark_2d_106 ['None', 3, 192, 192] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /Users/victorkhudyakov/.insightface/models/buffalo_l/det_10g.onnx detection [1, 3, '?', '?'] 127.5 128.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /Users/victorkhudyakov/.insightface/models/buffalo_l/genderage.onnx genderage ['None', 3, 96, 96] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /Users/victorkhudyakov/.insightface/models/buffalo_l/w600k_r50.onnx recognition ['None', 3, 112, 112] 127.5 127.5
set det-size: (640, 640)
INFO: InsightFace Buffalo-L успешно инициализирован
INFO: EmbeddingAnalyzer инициализирован
INFO: Извлечение 512D эмбеддинга из изображения (800, 800, 3)
ERROR: Ожидается 68 ландмарок, получено 0. Невозможно выполнить align_crop.
False 0.0
INFO: Конфигурация успешно импортирована
INFO: Конфигурация успешно импортирована
INFO: Конфигурация успешно импортирована
INFO: Конфигурация успешно импортирована
INFO: Конфигурация успешно импортирована
INFO: ✔ Конфигурация успешно импортирована.
INFO: ✔ Конфигурация и модули успешно импортированы.
DEBUG: load_ssl_context verify=True cert=None trust_env=True http2=False
DEBUG: load_verify_locations cafile='/Users/victorkhudyakov/.pyenv/versions/3.8.10/lib/python3.8/site-packages/certifi/cacert.pem'
DEBUG: connect_tcp.started host='api.gradio.app' port=443 local_address=None timeout=3 socket_options=None
DEBUG: load_ssl_context verify=True cert=None trust_env=True http2=False
DEBUG: load_verify_locations cafile='/Users/victorkhudyakov/.pyenv/versions/3.8.10/lib/python3.8/site-packages/certifi/cacert.pem'
DEBUG: load_ssl_context verify=True cert=None trust_env=True http2=False
DEBUG: load_verify_locations cafile='/Users/victorkhudyakov/.pyenv/versions/3.8.10/lib/python3.8/site-packages/certifi/cacert.pem'
DEBUG: load_ssl_context verify=True cert=None trust_env=True http2=False
DEBUG: load_verify_locations cafile='/Users/victorkhudyakov/.pyenv/versions/3.8.10/lib/python3.8/site-packages/certifi/cacert.pem'
DEBUG: Importing BlpImagePlugin
DEBUG: Importing BmpImagePlugin
DEBUG: Importing BufrStubImagePlugin
DEBUG: Importing CurImagePlugin
DEBUG: Importing DcxImagePlugin
DEBUG: Importing DdsImagePlugin
DEBUG: Importing EpsImagePlugin
DEBUG: Importing FitsImagePlugin
DEBUG: Importing FliImagePlugin
DEBUG: Importing FpxImagePlugin
DEBUG: Image: failed to import FpxImagePlugin: No module named 'olefile'
DEBUG: Importing FtexImagePlugin
DEBUG: Importing GbrImagePlugin
DEBUG: Importing GifImagePlugin
DEBUG: Importing GribStubImagePlugin
DEBUG: Importing Hdf5StubImagePlugin
DEBUG: Importing IcnsImagePlugin
DEBUG: Importing IcoImagePlugin
DEBUG: Importing ImImagePlugin
DEBUG: Importing ImtImagePlugin
DEBUG: Importing IptcImagePlugin
DEBUG: Importing JpegImagePlugin
DEBUG: Importing Jpeg2KImagePlugin
DEBUG: Importing McIdasImagePlugin
DEBUG: Importing MicImagePlugin
DEBUG: Image: failed to import MicImagePlugin: No module named 'olefile'
DEBUG: Importing MpegImagePlugin
DEBUG: Importing MpoImagePlugin
DEBUG: Importing MspImagePlugin
DEBUG: Importing PalmImagePlugin
DEBUG: Importing PcdImagePlugin
DEBUG: Importing PcxImagePlugin
DEBUG: Importing PdfImagePlugin
DEBUG: Importing PixarImagePlugin
DEBUG: Importing PngImagePlugin
DEBUG: Importing PpmImagePlugin
DEBUG: Importing PsdImagePlugin
DEBUG: Importing QoiImagePlugin
DEBUG: Importing SgiImagePlugin
DEBUG: Importing SpiderImagePlugin
DEBUG: Importing SunImagePlugin
DEBUG: Importing TgaImagePlugin
DEBUG: Importing TiffImagePlugin
DEBUG: Importing WebPImagePlugin
DEBUG: Importing WmfImagePlugin
DEBUG: Importing XbmImagePlugin
DEBUG: Importing XpmImagePlugin
DEBUG: Importing XVThumbImagePlugin
DEBUG: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x35be6cc70>
DEBUG: start_tls.started ssl_context=<ssl.SSLContext object at 0x352305440> server_hostname='api.gradio.app' timeout=3
DEBUG: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x35be7d310>
DEBUG: send_request_headers.started request=<Request [b'GET']>
DEBUG: send_request_headers.complete
DEBUG: send_request_body.started request=<Request [b'GET']>
DEBUG: send_request_body.complete
DEBUG: receive_response_headers.started request=<Request [b'GET']>
DEBUG: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 17 Jun 2025 16:10:09 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'3'), (b'Connection', b'keep-alive'), (b'Server', b'nginx/1.18.0'), (b'Access-Control-Allow-Origin', b'*')])
INFO: HTTP Request: GET https://api.gradio.app/gradio-messaging/en "HTTP/1.1 200 OK"
DEBUG: receive_response_body.started request=<Request [b'GET']>
DEBUG: receive_response_body.complete
DEBUG: response_closed.started
DEBUG: response_closed.complete
DEBUG: close.started
DEBUG: close.complete
INFO: Все компоненты системы успешно импортированы
INFO: Конфигурация успешно импортирована
INFO: ✔ ReportLab импортирована для PDF отчетов.
INFO: ✔ Plotly импортирована для интерактивных графиков.
INFO: ✔ Конфигурация успешно импортирована.
INFO: Все модули системы успешно импортированы с оригинальными названиями

======================================================================
Система анализа подлинности 3D лиц v2.0
Автор: AI Research Team
Дата сборки: 2025-06-15
======================================================================

INFO: ### Обработка аргументов запуска...
INFO: Выбранный режим работы: Режим тестирования
INFO: Отладочный режим выключен. Вывод будет кратким.
INFO: 
### Инициализация основной системы...
INFO: --- Инициализация системы 'Система анализа подлинности 3D лиц' v2.0 ---
INFO: 
### Шаг 1: Инициализация компонентов системы...
INFO: Проверка конфигурации...
INFO: Начало валидации конфигурации
INFO: Получение метрик идентичности
INFO: Загружено 15 метрик идентичности
INFO: Получение параметров хронологического анализа
INFO: Валидация конфигурации успешно завершена
INFO: Конфигурация в порядке.
INFO: Проверка и создание необходимых папок...
INFO: Все необходимые директории созданы.
INFO: Все нужные папки созданы.
INFO: Инициализация 'Менеджера данных' (data_manager)...
INFO: Инициализация DataManager
INFO: Загружено 7 исторических событий
INFO: DataManager инициализирован
INFO: Инициализация 'Расчетчика метрик' (metrics_calculator)...
INFO: --- Инициализация MetricsCalculator (Расчетчика метрик) ---
WARNING: ПРЕДУПРЕЖДЕНИЕ: Файл базовых линий метрик не найден. Используются значения по умолчанию.
INFO: Использование значений по умолчанию для базовых линий метрик.
INFO: --- MetricsCalculator успешно инициализирован ---
INFO: Инициализация '3D Анализатора лица' (face_3d_analyzer)...
INFO: Начало инициализации 3DDFA компонентов
INFO: FaceBoxes инициализирован
INFO: TDDFA (PyTorch) инициализирован
INFO: 3DDFA компоненты успешно инициализированы
INFO: Инициализация Face3DAnalyzer
WARNING: TDDFA модель не инициализирована или не содержит BFM для загрузки референсной модели.
INFO: Получение конфигураций видов
INFO: Получение метрик идентичности
INFO: Загружено 15 метрик идентичности
INFO: Face3DAnalyzer инициализирован
INFO: Инициализация 'Анализатора эмбеддингов' (embedding_analyzer)...
INFO: Инициализация EmbeddingAnalyzer
INFO: Начало инициализации InsightFace Buffalo-L
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /Users/victorkhudyakov/.insightface/models/buffalo_l/1k3d68.onnx landmark_3d_68 ['None', 3, 192, 192] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /Users/victorkhudyakov/.insightface/models/buffalo_l/2d106det.onnx landmark_2d_106 ['None', 3, 192, 192] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /Users/victorkhudyakov/.insightface/models/buffalo_l/det_10g.onnx detection [1, 3, '?', '?'] 127.5 128.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /Users/victorkhudyakov/.insightface/models/buffalo_l/genderage.onnx genderage ['None', 3, 96, 96] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /Users/victorkhudyakov/.insightface/models/buffalo_l/w600k_r50.onnx recognition ['None', 3, 112, 112] 127.5 127.5
set det-size: (640, 640)
INFO: InsightFace Buffalo-L успешно инициализирован
INFO: EmbeddingAnalyzer инициализирован
INFO: Инициализация 'Анализатора текстуры' (texture_analyzer)...
INFO: Инициализация TextureAnalyzer
INFO: Базовые линии загружены из /Users/victorkhudyakov/nn/3DDFA2/configs/texture_baselines.json
INFO: TextureAnalyzer инициализирован
INFO: Инициализация 'Временного анализатора' (temporal_analyzer)...
INFO: Инициализация TemporalAnalyzer
INFO: Загружено 7 медицинских событий
INFO: TemporalAnalyzer инициализирован
INFO: Инициализация 'Детектора аномалий' (anomaly_detector)...
INFO: Инициализация AnomalyDetector
INFO: AnomalyDetector инициализирован
INFO: Инициализация 'Медицинского валидатора' (medical_validator)...
INFO: Инициализация MedicalValidator
INFO: Загружено 7 документированных медицинских событий
INFO: MedicalValidator инициализирован
INFO: Инициализация 'Обработчика данных' (data_processor)...
INFO: --- Инициализация DataProcessor (Обработчика данных) ---
INFO: Инициализация внутренних анализаторов DataProcessor...
INFO: Начало инициализации 3DDFA компонентов
INFO: FaceBoxes инициализирован
INFO: TDDFA (PyTorch) инициализирован
INFO: 3DDFA компоненты успешно инициализированы
INFO: Инициализация Face3DAnalyzer
WARNING: TDDFA модель не инициализирована или не содержит BFM для загрузки референсной модели.
INFO: Получение конфигураций видов
INFO: Получение метрик идентичности
INFO: Загружено 15 метрик идентичности
INFO: Face3DAnalyzer инициализирован
INFO: Инициализация EmbeddingAnalyzer
INFO: Начало инициализации InsightFace Buffalo-L
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /Users/victorkhudyakov/.insightface/models/buffalo_l/1k3d68.onnx landmark_3d_68 ['None', 3, 192, 192] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /Users/victorkhudyakov/.insightface/models/buffalo_l/2d106det.onnx landmark_2d_106 ['None', 3, 192, 192] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /Users/victorkhudyakov/.insightface/models/buffalo_l/det_10g.onnx detection [1, 3, '?', '?'] 127.5 128.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /Users/victorkhudyakov/.insightface/models/buffalo_l/genderage.onnx genderage ['None', 3, 96, 96] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /Users/victorkhudyakov/.insightface/models/buffalo_l/w600k_r50.onnx recognition ['None', 3, 112, 112] 127.5 127.5
set det-size: (640, 640)
INFO: InsightFace Buffalo-L успешно инициализирован
INFO: EmbeddingAnalyzer инициализирован
INFO: Инициализация TextureAnalyzer
INFO: Базовые линии загружены из /Users/victorkhudyakov/nn/3DDFA2/configs/texture_baselines.json
INFO: TextureAnalyzer инициализирован
INFO: Инициализация TemporalAnalyzer
INFO: Загружено 7 медицинских событий
INFO: TemporalAnalyzer инициализирован
INFO: Инициализация DataManager
INFO: Загружено 7 исторических событий
INFO: DataManager инициализирован
INFO: --- Инициализация MetricsCalculator (Расчетчика метрик) ---
WARNING: ПРЕДУПРЕЖДЕНИЕ: Файл базовых линий метрик не найден. Используются значения по умолчанию.
INFO: Использование значений по умолчанию для базовых линий метрик.
INFO: --- MetricsCalculator успешно инициализирован ---
INFO: ✔ Все анализаторы успешно инициализированы.
INFO: --- DataProcessor успешно инициализирован ---
INFO: Инициализация 'Движка визуализации' (visualization_engine)...
INFO: Инициализация VisualizationEngine
INFO: VisualizationEngine инициализирован
INFO: Инициализация 'Генератора отчетов' (report_generator)...
INFO: --- Инициализация ReportGenerator ---
INFO: Загрузка шаблонов отчетов...
INFO: ✔ Шаблоны отчетов успешно загружены.
INFO: --- ReportGenerator инициализирован ---
INFO: Инициализация 'Агрегатора результатов' (results_aggregator)...
INFO: --- Инициализация ResultsAggregator (Агрегатора результатов) ---
INFO: Инициализация 'Интерфейса Gradio' (gradio_interface)...
INFO: Инициализация GradioInterface
INFO: SmartFileUploader инициализирован с лимитом 1500 файлов
INFO: Interactive3DViewer инициализирован
INFO: MetricsDashboard инициализирован
INFO: MaskDetectionDashboard инициализирован
INFO: RealTimeAnalyzer инициализирован
INFO: Interactive3DViewer инициализирован
INFO: MetricsDashboard инициализирован
INFO: MaskDetectionDashboard инициализирован
INFO: SmartFileUploader инициализирован с лимитом 1500 файлов
INFO: RealTimeAnalyzer инициализирован
INFO: GradioInterface полностью инициализирован
INFO: 
### Шаг 2: Загрузка кэшей системы...
INFO: Загрузка кэшей компонентов...
INFO: Кэш загружен: /Users/victorkhudyakov/nn/3DDFA2/cache/datamanager_cache.pkl
INFO: Кэш загружен: /Users/victorkhudyakov/nn/3DDFA2/cache/embedding_cache.pkl
INFO: Кэш анализа загружен: /Users/victorkhudyakov/nn/3DDFA2/cache/texture_cache.pkl
INFO: Кэш анализа загружен: /Users/victorkhudyakov/nn/3DDFA2/cache/temporal_cache.pkl
INFO: Кэш анализа загружен: /Users/victorkhudyakov/nn/3DDFA2/cache/anomaly_cache.pkl
INFO: Кэш валидации загружен: /Users/victorkhudyakov/nn/3DDFA2/cache/medical_validation_cache.pkl
INFO: Кэш графиков загружен: /Users/victorkhudyakov/nn/3DDFA2/cache/visualization_cache.pkl
INFO: Файл кэша результатов не найден. Кэш будет создан при сохранении.
INFO: ✔ Загрузка кэшей завершена.
INFO: 
### Шаг 3: Запуск самотестирования компонентов...
INFO: Запуск самотестирования компонентов...
INFO: Тестирование 'data_manager'...
INFO: === Самотестирование DataManager ===
INFO: Дата рождения: 1952-10-07
INFO: Диапазон анализа: 1999-01-01 00:00:00 - 2025-12-31 00:00:00
INFO: Исторических событий: 7
INFO: Тест парсинга дат:
INFO:   01_01_10.jpg -> 2010-01-01, seq=0
INFO:   15_06_01-2.jpeg -> 2001-06-15, seq=2
INFO:   31_12_99.jpg -> 1999-12-31, seq=0
INFO: Возраст на 2020-01-01 00:00:00: 67.23 лет
INFO: Тест качества: score=0.750
INFO: Корреляция 2 дат с историческими событиями
INFO: Найдено 2 корреляций для 2 дат
INFO: Тест корреляций: 2 найдено
INFO: Статистика: {'processing_stats': {'total_processed': 0, 'successful_parses': 0, 'failed_parses': 0, 'quality_passed': 1, 'quality_failed': 0}, 'chronological_index_size': 0, 'quality_cache_size': 0, 'results_cache_size': 0, 'historical_events_count': 7}
INFO: === Самотестирование завершено ===
INFO: ✔ Тест 'data_manager' пройден.
INFO: Тестирование 'metrics_calculator'...
INFO: 
=== Запуск самотестирования MetricsCalculator ===
INFO: Генерация тестовых 3D ландмарок для проверки...
INFO: Начинаем расчет 15 метрик идентичности для позы: 'test_pose'...
INFO: ✔ Успешно рассчитано 15 метрик идентичности.
INFO: Тест расчета метрик: успешно извлечено 15 метрик.
INFO: ✔ Расчет всех 15 метрик: ПРОЙДЕН.
INFO: Расчет схожести двух наборов метрик...
INFO: ✔ Расчет схожести метрик завершен. Общая схожесть: 0.995
INFO: Тест схожести метрик: Общая схожесть: 0.995
INFO: ✔ Тест схожести метрик: ПРОЙДЕН (высокая схожесть).
INFO: Проверка согласованности 3 наборов метрик во времени...
INFO: ✔ Проверка согласованности завершена. Общая согласованность: 0.733
INFO: Тест согласованности метрик во времени: Общая согласованность: 0.733
INFO: ✔ Тест согласованности метрик: ПРОЙДЕН (высокая согласованность).
INFO: Получение статистики MetricsCalculator...
INFO: ✔ Статистика MetricsCalculator получена.
INFO: Статистика MetricsCalculator после теста: 
INFO:   Всего вычислений: 1
INFO:   Успешно: 1
INFO:   Ошибок: 0
INFO:   Попаданий в кэш: 0
INFO:   Размер кэша: 1
INFO: === Самотестирование MetricsCalculator завершено ===

INFO: ✔ Тест 'metrics_calculator' пройден.
INFO: Тестирование 'face_3d_analyzer'...
INFO: Запуск самотестирования Face3DAnalyzer...
INFO: Загружено тестовое изображение с размером: (800, 800, 3)
INFO: Тестирование extract_68_landmarks_with_confidence...
ERROR: [extract_68_landmarks] Ошибка извлечения ландмарок: 'list' object has no attribute 'shape'
ERROR: Самотестирование Face3DAnalyzer завершено с ошибками: Expected (68,3) landmarks, got (0,)
ERROR: ОШИБКА: Тест 'face_3d_analyzer' не пройден: Expected (68,3) landmarks, got (0,)
INFO: Тестирование 'embedding_analyzer'...
INFO: Запуск самотеста EmbeddingAnalyzer...
INFO: Инициализация EmbeddingAnalyzer
INFO: Начало инициализации InsightFace Buffalo-L
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /Users/victorkhudyakov/.insightface/models/buffalo_l/1k3d68.onnx landmark_3d_68 ['None', 3, 192, 192] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /Users/victorkhudyakov/.insightface/models/buffalo_l/2d106det.onnx landmark_2d_106 ['None', 3, 192, 192] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /Users/victorkhudyakov/.insightface/models/buffalo_l/det_10g.onnx detection [1, 3, '?', '?'] 127.5 128.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /Users/victorkhudyakov/.insightface/models/buffalo_l/genderage.onnx genderage ['None', 3, 96, 96] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /Users/victorkhudyakov/.insightface/models/buffalo_l/w600k_r50.onnx recognition ['None', 3, 112, 112] 127.5 127.5
set det-size: (640, 640)
INFO: InsightFace Buffalo-L успешно инициализирован
INFO: EmbeddingAnalyzer инициализирован
INFO: Начало инициализации 3DDFA компонентов
INFO: FaceBoxes инициализирован
INFO: TDDFA (PyTorch) инициализирован
INFO: 3DDFA компоненты успешно инициализированы
INFO: Инициализация Face3DAnalyzer
WARNING: TDDFA модель не инициализирована или не содержит BFM для загрузки референсной модели.
INFO: Получение конфигураций видов
INFO: Получение метрик идентичности
INFO: Загружено 15 метрик идентичности
INFO: Face3DAnalyzer инициализирован
ERROR: [extract_68_landmarks] Ошибка извлечения ландмарок: 'list' object has no attribute 'shape'
ERROR: Face3DAnalyzer не обнаружил ландмарки для тестового изображения InsightFace.
ERROR: ❌ Ошибка в самотесте EmbeddingAnalyzer: Не удалось получить ландмарки для теста InsightFace
Traceback (most recent call last):
  File "/Users/victorkhudyakov/nn/3DDFA2/embedding_analyzer.py", line 816, in self_test
    raise RuntimeError("Не удалось получить ландмарки для теста InsightFace")
RuntimeError: Не удалось получить ландмарки для теста InsightFace
ERROR: ОШИБКА: Тест 'embedding_analyzer' не пройден: Не удалось получить ландмарки для теста InsightFace
INFO: Тестирование 'texture_analyzer'...
INFO: === Самотестирование TextureAnalyzer ===
INFO: LBP параметры: {'radius': 3, 'n_points': 24, 'method': 'uniform'}
INFO: Gabor параметры: {'orientations': [0, 45, 90, 135], 'frequencies': [0.1, 0.2, 0.3, 0.4]}
INFO: Калиброван: False
INFO: Анализ текстуры кожи по зонам. Изображение: (200, 200, 3)
INFO: Определение зон кожи лица
INFO: Определено 5 зон кожи
INFO: Анализ зоны: forehead
INFO: Анализ текстуры зоны
INFO: Расчет Shannon entropy
INFO: Shannon entropy рассчитан: 7.610
INFO: Расчет LBP features
INFO: LBP features рассчитаны успешно
INFO: Расчет Gabor responses
INFO: Gabor responses рассчитаны для 4x4 комбинаций
INFO: Расчет Fourier spectrum
INFO: Fourier spectrum рассчитан успешно
INFO: Расчет Haralick features
INFO: Haralick features рассчитаны успешно
INFO: Анализ зоны: left_cheek
INFO: Анализ текстуры зоны
INFO: Расчет Shannon entropy
INFO: Shannon entropy рассчитан: 7.608
INFO: Расчет LBP features
INFO: LBP features рассчитаны успешно
INFO: Расчет Gabor responses
INFO: Gabor responses рассчитаны для 4x4 комбинаций
INFO: Расчет Fourier spectrum
INFO: Fourier spectrum рассчитан успешно
INFO: Расчет Haralick features
INFO: Haralick features рассчитаны успешно
INFO: Анализ зоны: right_cheek
INFO: Анализ текстуры зоны
INFO: Расчет Shannon entropy
INFO: Shannon entropy рассчитан: 7.614
INFO: Расчет LBP features
INFO: LBP features рассчитаны успешно
INFO: Расчет Gabor responses
INFO: Gabor responses рассчитаны для 4x4 комбинаций
INFO: Расчет Fourier spectrum
INFO: Fourier spectrum рассчитан успешно
INFO: Расчет Haralick features
INFO: Haralick features рассчитаны успешно
INFO: Анализ зоны: nose
INFO: Анализ текстуры зоны
INFO: Расчет Shannon entropy
INFO: Shannon entropy рассчитан: 7.603
INFO: Расчет LBP features
INFO: LBP features рассчитаны успешно
INFO: Расчет Gabor responses
INFO: Gabor responses рассчитаны для 4x4 комбинаций
INFO: Расчет Fourier spectrum
INFO: Fourier spectrum рассчитан успешно
INFO: Расчет Haralick features
INFO: Haralick features рассчитаны успешно
INFO: Анализ зоны: chin
INFO: Анализ текстуры зоны
INFO: Расчет Shannon entropy
INFO: Shannon entropy рассчитан: 7.545
INFO: Расчет LBP features
INFO: LBP features рассчитаны успешно
INFO: Расчет Gabor responses
INFO: Gabor responses рассчитаны для 4x4 комбинаций
INFO: Расчет Fourier spectrum
INFO: Fourier spectrum рассчитан успешно
INFO: Расчет Haralick features
INFO: Haralick features рассчитаны успешно
INFO: Анализ текстуры завершен для 5 зон
INFO: Тест анализа текстуры: 5 зон проанализировано
INFO: Расчет оценки аутентичности материала
INFO: Оценка аутентичности материала: 0.371
INFO: Тест аутентичности: 0.371
INFO: Классификация уровня технологии маски
INFO: Классификация маски: Natural_Skin, confidence: 0.800
INFO: Тест классификации маски: Natural_Skin
INFO: Адаптивный анализ текстуры
INFO: Нормальные условия освещения. Предобработка не требуется
INFO: Анализ текстуры кожи по зонам. Изображение: (200, 200, 3)
INFO: Определение зон кожи лица
INFO: Определено 5 зон кожи
INFO: Анализ зоны: forehead
INFO: Анализ текстуры зоны
INFO: Расчет Shannon entropy
INFO: Shannon entropy рассчитан: 7.610
INFO: Расчет LBP features
INFO: LBP features рассчитаны успешно
INFO: Расчет Gabor responses
INFO: Gabor responses рассчитаны для 4x4 комбинаций
INFO: Расчет Fourier spectrum
INFO: Fourier spectrum рассчитан успешно
INFO: Расчет Haralick features
INFO: Haralick features рассчитаны успешно
INFO: Анализ зоны: left_cheek
INFO: Анализ текстуры зоны
INFO: Расчет Shannon entropy
INFO: Shannon entropy рассчитан: 7.608
INFO: Расчет LBP features
INFO: LBP features рассчитаны успешно
INFO: Расчет Gabor responses
INFO: Gabor responses рассчитаны для 4x4 комбинаций
INFO: Расчет Fourier spectrum
INFO: Fourier spectrum рассчитан успешно
INFO: Расчет Haralick features
INFO: Haralick features рассчитаны успешно
INFO: Анализ зоны: right_cheek
INFO: Анализ текстуры зоны
INFO: Расчет Shannon entropy
INFO: Shannon entropy рассчитан: 7.614
INFO: Расчет LBP features
INFO: LBP features рассчитаны успешно
INFO: Расчет Gabor responses
INFO: Gabor responses рассчитаны для 4x4 комбинаций
INFO: Расчет Fourier spectrum
INFO: Fourier spectrum рассчитан успешно
INFO: Расчет Haralick features
INFO: Haralick features рассчитаны успешно
INFO: Анализ зоны: nose
INFO: Анализ текстуры зоны
INFO: Расчет Shannon entropy
INFO: Shannon entropy рассчитан: 7.603
INFO: Расчет LBP features
INFO: LBP features рассчитаны успешно
INFO: Расчет Gabor responses
INFO: Gabor responses рассчитаны для 4x4 комбинаций
INFO: Расчет Fourier spectrum
INFO: Fourier spectrum рассчитан успешно
INFO: Расчет Haralick features
INFO: Haralick features рассчитаны успешно
INFO: Анализ зоны: chin
INFO: Анализ текстуры зоны
INFO: Расчет Shannon entropy
INFO: Shannon entropy рассчитан: 7.545
INFO: Расчет LBP features
INFO: LBP features рассчитаны успешно
INFO: Расчет Gabor responses
INFO: Gabor responses рассчитаны для 4x4 комбинаций
INFO: Расчет Fourier spectrum
INFO: Fourier spectrum рассчитан успешно
INFO: Расчет Haralick features
INFO: Haralick features рассчитаны успешно
INFO: Анализ текстуры завершен для 5 зон
INFO: Адаптивный анализ текстуры завершен
INFO: Тест адаптивного анализа: 6 результатов
INFO: === Самотестирование завершено ===
INFO: ✔ Тест 'texture_analyzer' пройден.
INFO: Тестирование 'temporal_analyzer'...
INFO: === Самотестирование TemporalAnalyzer ===
INFO: Aging model: {'elasticity_loss_per_year': 0.015, 'tissue_sagging_per_year': 1.51, 'bone_stability_threshold': 25, 'ipd_stability': True, 'skull_growth_stops_age': 18, 'soft_tissue_aging_rate': 0.02, 'baseline_year': 1999}
INFO: Analysis params: {'min_data_points': 5, 'max_gap_days': 180, 'seasonal_period': 365, 'changepoint_penalty': 10, 'aging_tolerance_per_year': 0.02, 'systematic_pattern_threshold': 0.15, 'temporal_stability_threshold': 0.8, 'medical_event_window_days': 30, 'appearance_frequency_threshold': 0.1, 'absence_threshold_days': 90}
INFO: Medical events: 7
INFO: Построение медицинской модели старения на 48 точках
INFO: Модель старения построена для 2 метрик
INFO: Тест модели старения: linear_regression
INFO: Предсказание метрик для возраста: 70.0
INFO: Предсказано 2 метрик
INFO: Тест предсказания: 2 метрик
INFO: Анализ временных аномалий в 48 точках
INFO: Обнаружено 11 временных аномалий
INFO: Тест аномалий: 11 аномалий
INFO: Сезонная декомпозиция для метрики: authenticity_score
INFO: Сезонная декомпозиция завершена. Сезонная сила: 0.639
INFO: Тест сезонной декомпозиции: 8 результатов
INFO: Обнаружение точек изменения для метрики: authenticity_score
INFO: Обнаружено 0 точек изменения
INFO: Тест точек изменения: 0 точек
INFO: Корреляция аномалий с медицинскими событиями
INFO: Найдено 0 корреляций аномалий с медицинскими событиями
INFO: Тест корреляций: 0 корреляций
INFO: Построение временной линии появлений идентичностей
INFO: Временная линия построена для 2 идентичностей
INFO: Тест временной линии: 2 идентичностей
INFO: Анализ паттернов смены идентичности для 2 идентичностей
INFO: Анализ смены идентичности завершен. Систематические паттерны: False
INFO: Тест паттернов смены: систематические=False
INFO: === Самотестирование завершено ===
INFO: ✔ Тест 'temporal_analyzer' пройден.
INFO: Тестирование 'anomaly_detector'...
INFO: === Самотестирование AnomalyDetector ===
INFO: Байесовские априорные: {'same_person': 0.5, 'different_person': 0.5}
INFO: Калиброван: False
INFO: Пороги каскада: {'geometry': 0.7, 'embedding': 0.8, 'texture': 0.6, 'temporal': 0.7}
INFO: Байесовский анализ для 2 идентичностей
INFO: Анализ идентичности: identity_1
INFO: Анализ идентичности: identity_2
INFO: Байесовский анализ завершен для 2 идентичностей
INFO: Тест байесовского анализа: 2 результатов
INFO: Выполнение каскадной верификации
INFO: Расчет итогового authenticity score
INFO: Итоговый authenticity score: 0.839
INFO: Каскадная верификация: 4/4 уровней пройдено
INFO: Тест каскадной верификации: 4/4 уровней
INFO: Расчет итогового authenticity score
INFO: Итоговый authenticity score: 0.839
INFO: Тест authenticity score: 0.839
INFO: Классификация уровня технологии маски
INFO: Классификация маски: Level4_Professional, confidence: 1.000
INFO: Тест классификации маски: Level4_Professional
INFO: Автокалибровка порогов на 3 образцах
INFO: Начало автокалибровки порогов
INFO: Калиброван min_authenticity_score: 0.65
INFO: Калиброван max_shape_error: 0.20
WARNING: Данные для калибровки по эпохам пропущены: отсутствует 'date' или неверный формат в {'authenticity_score': 0.7, 'anomaly_score': 0.1}
WARNING: Данные для калибровки по эпохам пропущены: отсутствует 'date' или неверный формат в {'authenticity_score': 0.8, 'anomaly_score': 0.05}
WARNING: Данные для калибровки по эпохам пропущены: отсутствует 'date' или неверный формат в {'authenticity_score': 0.6, 'anomaly_score': 0.2}
WARNING: Недостаточно данных для калибровки shape_error для Level1_Primitive. Используются значения по умолчанию.
WARNING: Недостаточно данных для калибровки entropy для Level1_Primitive. Используются значения по умолчанию.
WARNING: Недостаточно данных для калибровки shape_error для Level2_Basic. Используются значения по умолчанию.
WARNING: Недостаточно данных для калибровки entropy для Level2_Basic. Используются значения по умолчанию.
WARNING: Недостаточно данных для калибровки shape_error для Level3_Commercial. Используются значения по умолчанию.
WARNING: Недостаточно данных для калибровки entropy для Level3_Commercial. Используются значения по умолчанию.
WARNING: Недостаточно данных для калибровки shape_error для Level4_Professional. Используются значения по умолчанию.
WARNING: Недостаточно данных для калибровки entropy для Level4_Professional. Используются значения по умолчанию.
WARNING: Недостаточно данных для калибровки shape_error для Level5_Advanced. Используются значения по умолчанию.
WARNING: Недостаточно данных для калибровки entropy для Level5_Advanced. Используются значения по умолчанию.
INFO: Автокалибровка порогов завершена успешно
INFO: Автокалибровка порогов завершена успешно
INFO: Тест автокалибровки: 16 порогов
INFO: === Самотестирование завершено ===
INFO: ✔ Тест 'anomaly_detector' пройден.
INFO: Тестирование 'medical_validator'...
INFO: === Самотестирование MedicalValidator ===
INFO: Aging model: {'elasticity_loss_per_year': 0.015, 'tissue_sagging_per_year': 1.51, 'bone_stability_threshold': 25, 'ipd_stability': True, 'skull_growth_stops_age': 18, 'soft_tissue_aging_rate': 0.02, 'baseline_year': 1999}
INFO: Health events: 7
INFO: Калиброван: False
INFO: Валидация согласованности старения для 3 временных точек
INFO: Валидация согласованности завершена: score=0.464
INFO: Тест валидации старения: score=0.464
INFO: Проверка неизменности костной структуры для 2 метрик
INFO: Проверка костной структуры завершена для 2 метрик
INFO: Тест костной структуры: 2 метрик проанализировано
INFO: Анализ паттернов старения для 2 метрик мягких тканей
INFO: Анализ паттернов старения завершен для 2 метрик
INFO: Тест мягких тканей: 2 метрик проанализировано
INFO: Корреляция 2 аномалий с 7 медицинскими событиями
INFO: Найдено 2 корреляций аномалий с медицинскими событиями
INFO: Тест корреляций: 2 корреляций найдено
INFO: Генерация медицинского отчета
INFO: Медицинский отчет сгенерирован успешно
INFO: Тест отчета: 792 символов сгенерировано
INFO: === Самотестирование завершено ===
INFO: ✔ Тест 'medical_validator' пройден.
INFO: Тестирование 'data_processor'...
INFO: 
=== Запуск самотестирования DataProcessor ===
INFO: Создано тестовое изображение: test_image_dataprocessor.jpg
INFO: Запуск асинхронного теста обработки одного файла...
ERROR: FaceBoxes: 0 лиц обнаружено – проверьте изображение и освещение
WARNING: 3D анализ: ландмарки не обнаружены.
ERROR: ОШИБКА при обработке файла test_image_dataprocessor.jpg: 'NoneType' object has no attribute 'size'
ERROR: ✖ Тест обработки файла провален. Балл аутентичности: 0.000. Ошибка: 'NoneType' object has no attribute 'size'
INFO: Удалено тестовое изображение: test_image_dataprocessor.jpg
INFO: Получение статистики обработки DataProcessor...
INFO: ✔ Статистика обработки получена.
INFO: Статистика DataProcessor после теста: 
INFO:   Всего обработано: 0
INFO:   Успешно: 0
INFO:   Ошибок: 0
INFO:   Попаданий в кэш: 0
INFO:   Промахов кэша: 1
INFO:   Размер кэша: 0
INFO:   Коэффициент попаданий кэша: 0.00%
INFO: === Самотестирование DataProcessor завершено ===

INFO: ✔ Тест 'data_processor' пройден.
INFO: Тестирование 'visualization_engine'...
INFO: === Самотестирование VisualizationEngine ===
INFO: Создание 3D scatter plot для 50 эмбеддингов
INFO: 3D scatter plot создан успешно
INFO: Тест 3D scatter: 1 traces
INFO: Создание корреляционной матрицы 15x15
INFO: Корреляционная матрица 15x15 создана
INFO: Тест корреляционной матрицы: (15, 15)
INFO: Создание графика временных трендов
ERROR: Ошибка создания графика временных трендов: unsupported operand type(s) for +: 'int' and 'datetime.datetime'
INFO: Тест временных трендов: 0 traces
INFO: Создание dashboard обнаружения масок
INFO: Dashboard обнаружения масок создан
INFO: Тест dashboard масок: 2 traces
INFO: === Самотестирование завершено ===
INFO: ✔ Тест 'visualization_engine' пройден.
INFO: Тестирование 'report_generator'...
INFO: --- Запуск самопроверки ReportGenerator ---
INFO: Тестирование генерации HTML отчета...
INFO: === Генерация комплексного отчета в формате HTML ===
INFO: Подготовка данных отчета...
INFO:   -> Общий балл подлинности: 0.75
INFO:   -> Уровень риска: Низкий (low-risk)
INFO:   -> Загрузка данных анализа геометрии, эмбеддинга, текстуры и временного анализа.
INFO:   -> Идентификатор клиента: test_client_001
INFO: ✔ Данные отчета успешно подготовлены.
INFO: Генерация раздела 'Исполнительное резюме'...
INFO: ✔ Раздел 'Исполнительное резюме' сгенерирован.
INFO: Генерация раздела 'Анализ геометрии'...
INFO: ✔ Раздел 'Анализ геометрии' сгенерирован.
INFO: Генерация раздела 'Анализ эмбеддингов'...
INFO: ✔ Раздел 'Анализ эмбеддингов' сгенерирован.
INFO: Генерация раздела 'Анализ текстуры'...
INFO: ✔ Раздел 'Анализ текстуры' сгенерирован.
INFO: Генерация раздела 'Временной анализ'...
INFO: ✔ Раздел 'Временной анализ' сгенерирован.
INFO: Генерация раздела 'Обнаружение аномалий'...
INFO: ✔ Раздел 'Обнаружение аномалий' сгенерирован.
INFO: Генерация раздела 'Медицинская валидация'...
INFO: ✔ Раздел 'Медицинская валидация' сгенерирован.
INFO: Генерация раздела 'Визуализации'...
INFO: Подготовка данных для визуализаций...
INFO: ✔ Данные для визуализаций подготовлены.
INFO: ✔ Раздел 'Визуализации' сгенерирован (Plotly).
INFO: Генерация раздела 'Выводы и рекомендации'...
INFO: ✔ Раздел 'Выводы и рекомендации' сгенерирован.
INFO: Экспорт отчета в формат: HTML...
INFO: ✔ Отчет HTML сохранен: /Users/victorkhudyakov/nn/3DDFA2/results/test_client_001/report_20250617_191213.html
INFO: ✔ Отчет успешно сгенерирован и экспортирован в HTML.
INFO: ✔ HTML отчет успешно сгенерирован: /Users/victorkhudyakov/nn/3DDFA2/results/test_client_001/report_20250617_191213.html
INFO: Тестирование генерации PDF отчета...
INFO: === Генерация комплексного отчета в формате PDF ===
INFO: Подготовка данных отчета...
INFO:   -> Общий балл подлинности: 0.75
INFO:   -> Уровень риска: Низкий (low-risk)
INFO:   -> Загрузка данных анализа геометрии, эмбеддинга, текстуры и временного анализа.
INFO:   -> Идентификатор клиента: test_client_001
INFO: ✔ Данные отчета успешно подготовлены.
INFO: Генерация раздела 'Исполнительное резюме'...
INFO: ✔ Раздел 'Исполнительное резюме' сгенерирован.
INFO: Генерация раздела 'Анализ геометрии'...
INFO: ✔ Раздел 'Анализ геометрии' сгенерирован.
INFO: Генерация раздела 'Анализ эмбеддингов'...
INFO: ✔ Раздел 'Анализ эмбеддингов' сгенерирован.
INFO: Генерация раздела 'Анализ текстуры'...
INFO: ✔ Раздел 'Анализ текстуры' сгенерирован.
INFO: Генерация раздела 'Временной анализ'...
INFO: ✔ Раздел 'Временной анализ' сгенерирован.
INFO: Генерация раздела 'Обнаружение аномалий'...
INFO: ✔ Раздел 'Обнаружение аномалий' сгенерирован.
INFO: Генерация раздела 'Медицинская валидация'...
INFO: ✔ Раздел 'Медицинская валидация' сгенерирован.
INFO: Генерация раздела 'Визуализации'...
INFO: Подготовка данных для визуализаций...
INFO: ✔ Данные для визуализаций подготовлены.
INFO: ✔ Раздел 'Визуализации' сгенерирован (Plotly).
INFO: Генерация раздела 'Выводы и рекомендации'...
INFO: ✔ Раздел 'Выводы и рекомендации' сгенерирован.
INFO: Экспорт отчета в формат: PDF...
INFO: ✔ Отчет PDF сохранен: /Users/victorkhudyakov/nn/3DDFA2/results/test_client_001/report_20250617_191213.pdf
INFO: ✔ Отчет успешно сгенерирован и экспортирован в PDF.
INFO: ✔ PDF отчет успешно сгенерирован: /Users/victorkhudyakov/nn/3DDFA2/results/test_client_001/report_20250617_191213.pdf
INFO: Тестирование генерации CSV отчета...
INFO: === Генерация комплексного отчета в формате CSV ===
INFO: Подготовка данных отчета...
INFO:   -> Общий балл подлинности: 0.75
INFO:   -> Уровень риска: Низкий (low-risk)
INFO:   -> Загрузка данных анализа геометрии, эмбеддинга, текстуры и временного анализа.
INFO:   -> Идентификатор клиента: test_client_001
INFO: ✔ Данные отчета успешно подготовлены.
INFO: Генерация раздела 'Исполнительное резюме'...
INFO: ✔ Раздел 'Исполнительное резюме' сгенерирован.
INFO: Генерация раздела 'Анализ геометрии'...
INFO: ✔ Раздел 'Анализ геометрии' сгенерирован.
INFO: Генерация раздела 'Анализ эмбеддингов'...
INFO: ✔ Раздел 'Анализ эмбеддингов' сгенерирован.
INFO: Генерация раздела 'Анализ текстуры'...
INFO: ✔ Раздел 'Анализ текстуры' сгенерирован.
INFO: Генерация раздела 'Временной анализ'...
INFO: ✔ Раздел 'Временной анализ' сгенерирован.
INFO: Генерация раздела 'Обнаружение аномалий'...
INFO: ✔ Раздел 'Обнаружение аномалий' сгенерирован.
INFO: Генерация раздела 'Медицинская валидация'...
INFO: ✔ Раздел 'Медицинская валидация' сгенерирован.
INFO: Генерация раздела 'Визуализации'...
INFO: Подготовка данных для визуализаций...
INFO: ✔ Данные для визуализаций подготовлены.
INFO: ✔ Раздел 'Визуализации' сгенерирован (Plotly).
INFO: Генерация раздела 'Выводы и рекомендации'...
INFO: ✔ Раздел 'Выводы и рекомендации' сгенерирован.
INFO: Экспорт отчета в формат: CSV...
INFO: ✔ Отчет CSV сохранен: /Users/victorkhudyakov/nn/3DDFA2/results/test_client_001/report_20250617_191213.csv
INFO: ✔ Отчет успешно сгенерирован и экспортирован в CSV.
INFO: ✔ CSV отчет успешно сгенерирован: /Users/victorkhudyakov/nn/3DDFA2/results/test_client_001/report_20250617_191213.csv
INFO: Тестирование генерации Excel отчета...
INFO: === Генерация комплексного отчета в формате Excel ===
INFO: Подготовка данных отчета...
INFO:   -> Общий балл подлинности: 0.75
INFO:   -> Уровень риска: Низкий (low-risk)
INFO:   -> Загрузка данных анализа геометрии, эмбеддинга, текстуры и временного анализа.
INFO:   -> Идентификатор клиента: test_client_001
INFO: ✔ Данные отчета успешно подготовлены.
INFO: Генерация раздела 'Исполнительное резюме'...
INFO: ✔ Раздел 'Исполнительное резюме' сгенерирован.
INFO: Генерация раздела 'Анализ геометрии'...
INFO: ✔ Раздел 'Анализ геометрии' сгенерирован.
INFO: Генерация раздела 'Анализ эмбеддингов'...
INFO: ✔ Раздел 'Анализ эмбеддингов' сгенерирован.
INFO: Генерация раздела 'Анализ текстуры'...
INFO: ✔ Раздел 'Анализ текстуры' сгенерирован.
INFO: Генерация раздела 'Временной анализ'...
INFO: ✔ Раздел 'Временной анализ' сгенерирован.
INFO: Генерация раздела 'Обнаружение аномалий'...
INFO: ✔ Раздел 'Обнаружение аномалий' сгенерирован.
INFO: Генерация раздела 'Медицинская валидация'...
INFO: ✔ Раздел 'Медицинская валидация' сгенерирован.
INFO: Генерация раздела 'Визуализации'...
INFO: Подготовка данных для визуализаций...
INFO: ✔ Данные для визуализаций подготовлены.
INFO: ✔ Раздел 'Визуализации' сгенерирован (Plotly).
INFO: Генерация раздела 'Выводы и рекомендации'...
INFO: ✔ Раздел 'Выводы и рекомендации' сгенерирован.
INFO: Экспорт отчета в формат: Excel...
INFO: ✔ Отчет Excel сохранен: /Users/victorkhudyakov/nn/3DDFA2/results/test_client_001/report_20250617_191213.xlsx
INFO: ✔ Отчет успешно сгенерирован и экспортирован в Excel.
INFO: ✔ Excel отчет успешно сгенерирован: /Users/victorkhudyakov/nn/3DDFA2/results/test_client_001/report_20250617_191213.xlsx
INFO: Тестирование генерации JSON отчета...
INFO: === Генерация комплексного отчета в формате JSON ===
INFO: Подготовка данных отчета...
INFO:   -> Общий балл подлинности: 0.75
INFO:   -> Уровень риска: Низкий (low-risk)
INFO:   -> Загрузка данных анализа геометрии, эмбеддинга, текстуры и временного анализа.
INFO:   -> Идентификатор клиента: test_client_001
INFO: ✔ Данные отчета успешно подготовлены.
INFO: Генерация раздела 'Исполнительное резюме'...
INFO: ✔ Раздел 'Исполнительное резюме' сгенерирован.
INFO: Генерация раздела 'Анализ геометрии'...
INFO: ✔ Раздел 'Анализ геометрии' сгенерирован.
INFO: Генерация раздела 'Анализ эмбеддингов'...
INFO: ✔ Раздел 'Анализ эмбеддингов' сгенерирован.
INFO: Генерация раздела 'Анализ текстуры'...
INFO: ✔ Раздел 'Анализ текстуры' сгенерирован.
INFO: Генерация раздела 'Временной анализ'...
INFO: ✔ Раздел 'Временной анализ' сгенерирован.
INFO: Генерация раздела 'Обнаружение аномалий'...
INFO: ✔ Раздел 'Обнаружение аномалий' сгенерирован.
INFO: Генерация раздела 'Медицинская валидация'...
INFO: ✔ Раздел 'Медицинская валидация' сгенерирован.
INFO: Генерация раздела 'Визуализации'...
INFO: Подготовка данных для визуализаций...
INFO: ✔ Данные для визуализаций подготовлены.
INFO: ✔ Раздел 'Визуализации' сгенерирован (Plotly).
INFO: Генерация раздела 'Выводы и рекомендации'...
INFO: ✔ Раздел 'Выводы и рекомендации' сгенерирован.
INFO: Экспорт отчета в формат: JSON...
INFO: ✔ Отчет JSON сохранен: /Users/victorkhudyakov/nn/3DDFA2/results/test_client_001/report_20250617_191213.json
INFO: ✔ Отчет успешно сгенерирован и экспортирован в JSON.
INFO: ✔ JSON отчет успешно сгенерирован: /Users/victorkhudyakov/nn/3DDFA2/results/test_client_001/report_20250617_191213.json
INFO: Тестирование обработки некорректного формата...
INFO: === Генерация комплексного отчета в формате UNKNOWN ===
ERROR: Неподдерживаемый формат экспорта: UNKNOWN. Поддерживаемые форматы: HTML, PDF, CSV, Excel, JSON
INFO: ✔ Обработка некорректного формата прошла успешно.
INFO: Запрос статистики генерации отчетов.
INFO: --- Статистика генерации отчетов ---
INFO: Всего попыток: 6
INFO: Успешных экспортов: 5
INFO: Неудачных экспортов: 1
INFO: Использованные форматы: {'HTML': 1, 'PDF': 1, 'CSV': 1, 'Excel': 1, 'JSON': 1, 'UNKNOWN': 1}
INFO: --- Самопроверка ReportGenerator завершена ---
INFO: ✔ Тест 'report_generator' пройден.
INFO: 
### Результаты самотестирования всех компонентов:
INFO:   ✔ data_manager: Пройдено
INFO:   ✔ metrics_calculator: Пройдено
ERROR:   ✖ face_3d_analyzer: ОШИБКА (Expected (68,3) landmarks, got (0,))
ERROR:   ✖ embedding_analyzer: ОШИБКА (Не удалось получить ландмарки для теста InsightFace)
INFO:   ✔ texture_analyzer: Пройдено
INFO:   ✔ temporal_analyzer: Пройдено
INFO:   ✔ anomaly_detector: Пройдено
INFO:   ✔ medical_validator: Пройдено
INFO:   ✔ data_processor: Пройдено
INFO:   ✔ visualization_engine: Пройдено
INFO:   ✔ report_generator: Пройдено
INFO:   - results_aggregator: Без теста
INFO:   - gradio_interface: Без теста
WARNING: ПРЕДУПРЕЖДЕНИЕ: Некоторые критические компоненты не прошли тестирование: face_3d_analyzer, embedding_analyzer
INFO: ✔ Самотестирование завершено.
INFO: 
✔ Все компоненты системы успешно инициализированы!
INFO: --- Система успешно инициализирована и готова к работе ---
INFO: 
### Запуск системы в ТЕСТОВОМ режиме...
INFO: 
### Получение статуса системы...
INFO: ✔ Статус системы получен.

Текущий статус системы:
  Инициализирована: True
  Работает: False
  Количество компонентов: 13
  Версия системы: 2.0
  Время непрерывной работы: 0.00 сек.
(base) victorkhudyakov@MacBook-Pro-Victor 3DDFA2 % 